# Тикет система

## Требования

Python, Flask, PostgreSQL, SQLAlchemy, uWSGI, Redis

## Настройка

Переменные и настройки системы(пути, переходы состояний тикетов) для конфигурации системы описаны в файле config.py.
Т.к. отсутствует система авторизации, был добавлен TEST_USER, которым можно управлять через env переменную. Предполагается, 
что это известный пользователь.

В начале необходимо загрузить все зависимости из requirements.txt.

Запуск системы:

```
export FLASK_APP=server.py
flask run 
```

или через uWSGI:

```
uwsgi --socket 0.0.0.0:5000 --protocol=http -w wsgi:app
```

Переменные для подключения к БД описаны в PGConfig из config.py.
Данные будут хранится в схеме TEST.
В migrations уже добавлена первая миграция, которая создает таблицы для тикетов и комментариев, для выполнения миграции:

```
flask db upgrade
```


Кэширование работает для GET запрсоов о получении информации о тикете с помощью Redis из докера.

```
docker-compose up -d --build
```

Проверить кэширующиеся записи можно через:

```
redis-cli -h localhost -p 6379
localhost:6379> KEYS *
```

## API

1) POST api/ticket - создание тикета. 

Для создания тикета требуется передать только name(тема тикета), 
description(текст тикета). Email будет подставлен как текущий TEST_USER, время создания и время обновления тикета - 
текущее время в utc. Статус тикета при создании - "Открыт".

2) PUT api/ticket/{id} - обновление статуса тикета.

Возможные переходы state(статуса) описаны в config.py. Если переход из текущего состояния в переданное не описано - 
не зарегистрированный переход, возвращаем error.

3) POST api/ticket/{id}/comment - добавление комментария к тикету.

Комментарий должен содержать text(текст комментария). Email также будет подставлен из TEST_USER.
Комментарии можно оставлять для тикета, чье состояние не CLOSED(закрыто).

4) GET api/ticket/{id} - получить тикет.

К информации о тикете будут добавлены комментарии.

Тестировалось через Postman. 

